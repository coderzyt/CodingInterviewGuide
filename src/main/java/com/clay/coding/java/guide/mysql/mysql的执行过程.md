**话题很多，一个个写。先从第一个问题开始：**Java应用怎么调用 MySQL 的？MySQL 怎么执行一条 SQL 语句的。

![图片](https://mmbiz.qpic.cn/mmbiz_png/9YwUokWE01zKD73H0ZPUlk3s5GHONo5jMUbUErybsH8FuXj6wIKSWFzZ11a14Ld792G0fEQzpZlVQiadDNaAnwA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1 "image.png")

**现在比如说有一条 SQL 语句** `select name from user where id = 11;` **要通过 Java 程序去查询，那会是怎么一个流程呢？**

1. **首先用户给后台发一个请求，我们会把程序部署在web容器里，一般来说就是 tomcat。**
2. **Tomcat 做的事情就是监听端口号，把用户的请求都通过我们的程序来处理。**
3. **Java 程序接到请求后，就是 controller -> server -> dao，dao 层则会去访问数据库。**
4. **Java 程序和数据库通过什么连接？实际上就是通过数据库连接池，连接池里面会有很多的线程，dao 层发的请求就会交给数据库连接池中的某个线程来处理。**
5. **数据库连接池就连着 MySQL 数据库，它建立连接着时候是要校验用户名、密码等，完成一系列连接操作。此时就是和 MySQL 的**连接器**在打交道。**
6. **MySQL 后台会启动监听线程，监听到程序给它发的请求，就要开始处理这条 SQL 了。**

**想象一下，现在我们要执行**`select name from user where id = 11;`这样一个 SQL 语句，第一步会是什么？第一步是不是应该通过 where 后面的子句，把它这个查询条件先给用上？

**MySQL 中有一个**查询缓存**，如果你开启了查询缓存，则之前执行过的语句和对应的结果，会以KV形式存储在缓存中。不过我们一般不会开启缓存，且 MySQL8 之后已经没有查询缓存这个功能。**

**高版本的 MySQL 没有查询缓存，或者说没有用到查询缓存，那就会直接用**分析器（Parser）**来分析 SQL 语句。分析器会对 SQL 进行词法分析，语法分析，简单来说就是解析 SQL 的一些关键词、表名、字段名什么的。比如说**`select name from user where id = 11;`这个语句就会被解析成三部分：

1. **我们要从 users 表里查询数据**
2. **查的数据是这个表里面 id = 11 的那一行**
3. **查出来的结果多的我不要，只需要 name 这字段**

**分析完之后，MySQL 会通过**优化器（Optimizer）**对语句进行优化，优化器做的事情就是找到最优的查询路径。什么叫最优的查询路径呢？简单来讲就是决定怎么查询最快。还是那条 SQL 语句，它可以有怎么样的查询路径？**

* **先找到 id = 11 的那一行数据，再把 name 字段筛选出来，这是一条路径。**
* **还可以怎么样？我先把所有数据的 name 字段查出来，再从这些结果里面找 id = 11 的。**

**优化器会生成一套执行计划，然后不停的调用存储引擎的各种接口去完成这些计划。MySQL 中的**执行器**就是专门负责调用存储引擎接口的。**
